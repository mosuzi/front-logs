<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Front Logs</title>
    <!-- browser.js is generated by `npm run build:demo` -->
    <script defer src="browser.js" type="text/javascript"></script>
  </head>
  <body>
    <button id="append">记录</button>
    <button id="append2">记录2</button>
    <button id="append3">记录3</button>
    <button id="append4">记录4</button>
    <button id="submit">发送</button>
    <button id="delete">删除</button>
    <button id="start">启动</button>
    <button id="close">停止</button>
    <script type="text/javascript">
      let logEngine
      const baseDomain = 'http://127.0.0.1:3000'
      window.onload = function () {
        const FG = FrontLogs
        logEngine = new FG.LogEngine()
        logEngine.setSendInterval(9)
        FG.LogRequest.setGlobalArguments({ baseDomain })
        const logRequest = new FG.LogRequest({ url: '/push/logs', logsPath: 'customLogs' })
        logEngine.setLogRequest(logRequest)
        logEngine.send()
        const logHandler = new FG.LogHandler()
        logHandler.connect()
        const logHandler2 = new FG.LogHandler()
        logHandler2.connect()
        let count = 0

        const appendBtn = document.getElementById('append')
        appendBtn.onclick = function () {
          const log = new FG.LogBean('custom type', 'hello world!!!!!!!: ' + count)
          logHandler.appendCustomLog(log)
          console.log(log.toString())
          count++
        }
        const appendBtn2 = document.getElementById('append2')
        appendBtn2.onclick = function () {
          const log = new FG.LogBean(
            'custom type',
            'second handler!!!!!!!: ' + count,
            'http://127.0.0.1:2222'
          )
          logHandler2.appendCustomLog(log)
          console.log(log.toString())
          count++
        }
        const appendBtn3 = document.getElementById('append3')
        appendBtn3.onclick = function () {
          const log = new FG.LogBean(
            'custom type',
            'second handler!!!!!!!: ' + count,
            undefined,
            '/test/custom/api/3333'
          )
          logHandler2.appendCustomLog(log)
          console.log(log.toString())
          count++
        }
        const appendBtn4 = document.getElementById('append4')
        appendBtn4.onclick = function () {
          const log = new FG.LogBean(
            'custom type',
            'second handler!!!!!!!: ' + count,
            'http://127.0.0.1:4444',
            '/test/4444'
          )
          logHandler2.appendCustomLog(log)
          console.log(log.toString())
          count++
        }

        const submitBtn = document.getElementById('submit')
        submitBtn.onclick = function () {
          logHandler.sendLog()
        }
        const deleteBtn = document.getElementById('delete')
        deleteBtn.onclick = function () {
          fetch(baseDomain + '/delete/logs', { method: 'GET' }).then(resp => {
            if (resp.ok) count = 0
          })
        }
        const startBtn = document.getElementById('start')
        startBtn.onclick = function () {
          if (logEngine) return
          logEngine = new FG.LogEngine()
          logEngine.setSendInterval(3)
          logEngine.setLogRequest(logRequest)
          logEngine.send()
        }
        const closeBtn = document.getElementById('close')
        closeBtn.onclick = function () {
          if (!logEngine) return
          logEngine.destroy()
          logEngine = null
        }
      }
    </script>
  </body>
</html>
